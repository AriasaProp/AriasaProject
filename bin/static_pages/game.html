<!DOCTYPE html>
<html lang='en'>
<head>
  <title>Fermity - Game</title>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <meta name='author' content='AriasaProp'>
  <meta name='description' content='Game page.'>
  <link rel='icon' type='image/x-icon' href='/assets/favicon.ico'>
  <link rel='icon' type='image/png' sizes='16x16' href='/assets/favicon-16x16.png'>
  <link rel='icon' type='image/png' sizes='32x32' href='/assets/favicon-32x32.png'>
  <link rel='apple-touch-icon' sizes='180x180' href='/assets/apple-touch-icon.png'>
  <link rel='preconnect' href='https://fonts.googleapis.com' crossorigin>
  <link rel='preconnect' href='https://fonts.gstatic.com' crossorigin>
  <link rel='preload' href='https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;700' as='style' onload="this.onload=null;this.rel='stylesheet'">
  <link rel='preload' href='https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght@28,700' as='style' onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;700'>
    <link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,opsz@200,28'>
  </noscript>
  <link rel='stylesheet' href='/assets/common.css'>
  <link rel='stylesheet' href='/assets/game.css'>
  <script src='/assets/common.js'></script>
</head>
<body>
  <noscript><span id='blocked'>Blocked: [need javascript to load!]</span></noscript>
  <header>
    <nav>
      <a href='/'><h2>Fermity</h2></a>
      <span></span>
      <a href='/pref.html' class='material-symbols-outlined'>&#xf859</a>
      <a href='/empty.html' class='material-symbols-outlined'>&#xf859</a>
      <input id='ai' type='checkbox'>
      <label id='al' for='ai' class='material-symbols-outlined'></label>
      <form id='ab' action='/' method='GET'>
        <input name='s' type='text' placeholder='Search' required>
        <button type='reset' class='material-symbols-outlined'>&#xe6d0;</button>
        <button type='submit' class='material-symbols-outlined'>&#xe8b6;</button>
      </form>
    </nav>
  </header>
<main>
  <script id='vertShader' type='x-shader/x-vertex'> 
attribute vec3 a_position;
attribute vec4 a_color;

uniform mat4 u_viewProj;
uniform mat4 u_worldProj;

varying vec4 vColor;

void main(void) {
  gl_Position =  u_viewProj * u_worldProj * vec4(a_position, 1.0);
  vColor = a_color;
}
  </script>
  <script id='fragShader' type='x-shader/x-fragment'> 
precision mediump float;

varying vec4 vColor;
void main(void) {
  gl_FragColor = vColor;
}
  </script> 
  <canvas id='cvs' width='800' height='600'></canvas>
  <div id='logging'>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
  </div>
  <script>
function matrixRotate(mat,ipos, time) {
  const x = Math.PI * ipos.x * time;
  const y = Math.PI * ipos.y * time;
  const cx = Math.cos(x);
  const cy = Math.cos(y);
  const sx = Math.sin(x);
  const sy = Math.sin(y);
  const b = [
        cy, 0.0,    sy, 0.0,
     sy*sx,  cx,-sx*cy, 0.0,
    -sy*cx,  sx, cx*cy, 0.0,
       0.0, 0.0,   0.0, 1.0,
  ];
  let t = Array.apply(0.0, new Float32Array(16));
  for (let i = 0; i < 4; i++) // baris
    for (let j = 0; j < 4; j++) // kolom
      for (let k = 0; k < 4; k++)
        t[j * 4 + i] += mat[k * 4 + i] * b[j * 4 + k];
  return t;
}
/*
// initialize context webgl
console.log = (...args) => {
  let safeString = args.join();
  for (const p of logging.children) {
    let temp = p.textContent;
    p.textContent = safeString;
    if (value === undefined || value === null || value === "") break;
    safeString = temp;
  }
};
*/
function createCube(cp) {
  const s = cp.s;
  const cr = cp.x + s;
  const cl = cp.x - s;
  const ct = cp.y + s;
  const cb = cp.y - s;
  const ck = cp.z + s;
  const cf = cp.z - s;
  return [
   // front red
   cr,ct,cf, 1.0, 0.0, 0.0, 1.0,
   cl,ct,cf, 1.0, 0.0, 0.0, 1.0,
   cr,cb,cf, 1.0, 0.0, 0.0, 1.0,
   cl,cb,cf, 1.0, 0.0, 0.0, 1.0,
   // left blue
   cl,ct,cf, 0.0, 0.0, 1.0, 1.0,
   cl,ct,ck, 0.0, 0.0, 1.0, 1.0,
   cl,cb,cf, 0.0, 0.0, 1.0, 1.0,
   cl,cb,ck, 0.0, 0.0, 1.0, 1.0,
   // right teal
   cr,ct,ck, 0.0, 1.0, 1.0, 1.0,
   cr,ct,cf, 0.0, 1.0, 1.0, 1.0,
   cr,cb,ck, 0.0, 1.0, 1.0, 1.0,
   cr,cb,cf, 0.0, 1.0, 1.0, 1.0,
   // back purple
   cl,ct,ck, 1.0, 0.0, 1.0, 1.0,
   cr,ct,ck, 1.0, 0.0, 1.0, 1.0,
   cl,cb,ck, 1.0, 0.0, 1.0, 1.0,
   cr,cb,ck, 1.0, 0.0, 1.0, 1.0,
   // top green
   cr,ct,ck, 0.0, 1.0, 0.0, 1.0,
   cl,ct,ck, 0.0, 1.0, 0.0, 1.0,
   cr,ct,cf, 0.0, 1.0, 0.0, 1.0,
   cl,ct,cf, 0.0, 1.0, 0.0, 1.0,
   // bottom yellow
   cr,cb,cf, 1.0, 1.0, 0.0, 1.0,
   cl,cb,cf, 1.0, 1.0, 0.0, 1.0,
   cr,cb,ck, 1.0, 1.0, 0.0, 1.0,
   cl,cb,ck, 1.0, 1.0, 0.0, 1.0,
  ];
}
function elemCube(st) {
  let A = [];
  for (let i = st, j = st + 24; i < j;i += 4) {
    A.push(
      i, i + 1, i + 2,
      i + 2, i + 1, i + 3
    );
  }
  return A;
}
try {
  var gl = cvs.getContext("webgl");
  if (!gl) gl = cvs.getContext("experimental-webgl");
  if (!gl) throw new Error("Could not initialise WebGL, sorry :-(");
  cvs.ondragstart = () => false;
  const vprt = {
    w: cvs.width, h: cvs.height,
    n: 1, f: 1000,
  };
  
  var program = null;
  {
    // initialize shader program
    var vertexShader = gl.createShader(gl.VERTEX_SHADER);
    gl.shaderSource(vertexShader, vertShader.text);
    gl.compileShader(vertexShader);
    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {
      gl.deleteShader(vertexShader);
      throw ("Error compiling vertex shader: " + gl.getShaderInfoLog(vertexShader));
    }
    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
    gl.shaderSource(fragmentShader, fragShader.text);
    gl.compileShader(fragmentShader);
    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {
      gl.deleteShader(vertexShader);
      gl.deleteShader(fragmentShader);
      throw ("Error compiling fragment shader: " + gl.getShaderInfoLog(fragmentShader));
    }
    program = gl.createProgram();
    gl.attachShader(program, vertexShader);
    gl.attachShader(program, fragmentShader);
    gl.linkProgram(program);
    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
      gl.deleteProgram(program);
      gl.deleteShader(vertexShader);
      gl.deleteShader(fragmentShader);
      throw ("Could not initialise shaders " + gl.getProgramInfoLog(program));
    }
    gl.useProgram(program);
    // they say we need to detach
    gl.detachShader(program, vertexShader);
    gl.detachShader(program, fragmentShader);
    // they say we don't need to delete after detach (https://registry.khronos.org/OpenGL-Refpages/gl4/html/glDetachShader.xhtml)
    gl.deleteShader(vertexShader);
    gl.deleteShader(fragmentShader);
    program.attr = {
      position: gl.getAttribLocation(program, "a_position"),
      color: gl.getAttribLocation(program, "a_color")
    };
    gl.enableVertexAttribArray(program.attr.position);
    gl.enableVertexAttribArray(program.attr.color);
    program.uniform = {
      worldProj: gl.getUniformLocation(program, "u_worldProj"),
      viewProj: gl.getUniformLocation(program, "u_viewProj")
    };
  }
  // set triangles
  var triangles = null;
  {
    triangles = {
      vArray: [],
      iArray: [],
      vbo: gl.createBuffer(),
      ibo: gl.createBuffer(),
    };
    // xyz , rgba
    triangles.vArray.push(...createCube({x: 0, y: 150.25, z: 0,s: 150}));
    triangles.iArray.push(...elemCube(0));

    gl.bindBuffer(gl.ARRAY_BUFFER, triangles.vbo);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(triangles.vArray), gl.STATIC_DRAW);
    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, triangles.ibo);
    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint8Array(triangles.iArray), gl.STATIC_DRAW);
    
  }
  gl.viewport(0, 0, vprt.w, vprt.h);
  gl.clearColor(0.0, 0.0, 0.0, 1.0);
  gl.enable(gl.DEPTH_TEST);
  gl.enable(gl.CULL_FACE);
  gl.depthFunc(gl.LEQUAL);
  gl.depthRange(vprt.n, vprt.f);
  
  var viewProjMat = [
    2/vprt.w, 0, 0, 0,
    0, 2/vprt.h, 0, 0,
    0, 0, 2/(vprt.f - vprt.n), 0,
    0, 0, 0, 1
  ];
  var worldProjMat = [
    1, 0, 0, 0,
    0, 1, 0, 0,
    0, 0, 1, 0,
    0, 0, 0, 1
  ];
  gl.uniformMatrix4fv(program.uniform.worldProj, false, new Float32Array(worldProjMat));
  gl.uniformMatrix4fv(program.uniform.viewProj, false, new Float32Array(viewProjMat));
  {
    const stride = 7 * Float32Array.BYTES_PER_ELEMENT;
    gl.vertexAttribPointer(program.attr.position, 3, gl.FLOAT, false, stride, 0);
    gl.vertexAttribPointer(program.attr.color, 4, gl.FLOAT, false, stride, 3 * Float32Array.BYTES_PER_ELEMENT);
  }
  let ps = {
    xs: 0, ys: 0,
    xe: 0, ye: 0,
    distX () { return (this.xe - this.xs); },
    distY () { return (this.ye - this.ys); },
    moved () { this.xe = this.xs; this.ye = this.ys; },
    hasMove () { return (Math.abs(this.distX()) > 0.01) && (Math.abs(this.distY()) > 0.01); }
  };
  var timeStart;
  function drawUpdate(time) {
    if (timeStart) {
      let step = (time - timeStart) / (60 * 1000);
      if (ps.hasMove()) {
        worldProjMat = matrixRotate(worldProjMat,{x: ps.distY(), y: ps.distX()}, step);
        ps.moved();
        gl.uniformMatrix4fv(program.uniform.worldProj, false, new Float32Array(worldProjMat));
      }
    }
    timeStart = time;
    // clear canvas
    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    gl.drawElements(gl.TRIANGLES, triangles.iArray.length, gl.UNSIGNED_BYTE, 0);
    requestAnimationFrame(drawUpdate);
  }
  cvs.addEventListener('pointerdown',(e) => {
    ps.xs = e.clientX;
    ps.ys = e.clientY;
    ps.xe = e.clientX;
    ps.ye = e.clientY;
  });
  cvs.addEventListener('pointermove',(e) => {
    ps.xe = e.clientX;
    ps.ye = e.clientY;
  });
  requestAnimationFrame(drawUpdate);
} catch (e) {
  console.error(e);
  cvs.style.display = "none";
}
  </script>
</main>
  <footer>
    <a href='mailto:ikomangwidiadaariasa12@gmail.com'><p>Google mail</p></a>
    <a href='https://github.com/AriasaProp'><p>Github</p></a>
    <a href='#'><p>Instagram</p></a>
    <a href='#'><p>Facebook</p></a>
    <a href='#'><p>Twitter</p></a>
    <hr/>
    <p>2025 AriasaProp | Made for fun!</p>
  </footer>
</body>
</html>